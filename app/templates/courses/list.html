{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 mb-0">Courses</h1>
  <div class="d-flex gap-2">
    {% if show_all %}
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('courses.list_courses') }}">Show active only</a>
    {% else %}
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('courses.list_courses') }}?show_all=1">View all</a>
    {% endif %}
    <a class="btn btn-sm btn-primary" href="{{ url_for('courses.create_course') }}"><i class="fa fa-plus"></i> New</a>
  </div>
</div>

{% if not courses %}
  <div class="alert alert-info">No courses found.</div>
{% else %}
  <div class="d-flex flex-column gap-2">
    {% for c in courses %}
      <div class="card {% if not c.is_active %}border-secondary-subtle bg-light{% endif %}">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-semibold">
              {{ c.name }}
              {% if not c.is_active %}<span class="badge text-bg-secondary ms-2">Inactive</span>{% endif %}
            </div>
            <div class="small text-muted">{{ c.semester }} Â· Year {{ c.year }}</div>
          </div>
          <div class="d-flex gap-2 align-items-center flex-wrap justify-content-end">
            <a class="btn btn-outline-primary" href="{{ url_for('attendance.course_attendance', course_id=c.id) }}">
              <i class="fa-solid fa-user-check me-1"></i>Attendance
            </a>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('courses.enroll', course_id=c.id) }}">Enroll</a>
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('courses.students_in_course', course_id=c.id) }}">Roster</a>
            <a class="btn btn-outline-secondary" href="{{ url_for('seating.seating_view', course_id=c.id) }}">Seating plan</a>

            {% set has_lessons = c.lessons is defined and (c.lessons|length > 0) %}
            {% if not has_lessons %}
              <a class="btn btn-sm btn-primary" href="{{ url_for('schedule.schedule_setup', course_id=c.id) }}">
                <i class="fa-solid fa-calendar-plus me-1"></i> Set up schedule
              </a>
            {% else %}
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('schedule.course_schedule', course_id=c.id) }}">
                <i class="fa-solid fa-calendar-days me-1"></i> View schedule
              </a>
            {% endif %}

            {% if c.is_active %}
              <form method="post" action="{{ url_for('courses.deactivate', course_id=c.id) }}" class="m-0">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Make this course inactive?');">Make inactive</button>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}
