{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Edit User â€” {{ u.first_name }} {{ u.last_name }}</h1>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin.users_index') }}">Back</a>
  </div>

  <form method="post" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label" for="first_name">First Name</label>
        <input class="form-control" id="first_name" name="first_name" type="text" value="{{ u.first_name }}" required>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="last_name">Last Name</label>
        <input class="form-control" id="last_name" name="last_name" type="text" value="{{ u.last_name }}" required>
      </div>

      <div class="col-md-6">
        <label class="form-label" for="email">Email</label>
        <input class="form-control" id="email" name="email" type="email" value="{{ u.email }}" required>
      </div>
      <div class="col-md-3">
        <label class="form-label" for="student_code">Student Code</label>
        <input class="form-control" id="student_code" name="student_code" type="text" value="{{ u.student_code or '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label" for="registration_method">Registration Method</label>
        <select class="form-select" id="registration_method" name="registration_method">
          <option value="site" {% if u.registered_method == 'site' %}selected{% endif %}>site</option>
          <option value="bulk" {% if u.registered_method == 'bulk' %}selected{% endif %}>bulk</option>
        </select>
      </div>

      <div class="col-md-3 d-flex align-items-center">
        <div class="form-check mt-4">
          <input class="form-check-input" id="is_active" name="is_active" type="checkbox" {% if u.is_active %}checked{% endif %}>
          <label class="form-check-label" for="is_active">Is Active</label>
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label" for="roles">Roles</label>
        <select class="form-select" id="roles" name="roles" multiple size="6">
          {% for r in roles %}
            <option value="{{ r.id }}" {% if r in u.roles %}selected{% endif %}>{{ r.name }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Hold Ctrl/Cmd to toggle multiple roles.</div>
      </div>

      <div class="col-md-6">
        <label class="form-label" for="groups">Groups</label>
        <select class="form-select" id="groups" name="groups" multiple size="8">
          {% for g in groups %}
            <option value="{{ g.id }}" {% if g in u.groups %}selected{% endif %}>{{ g.name }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Hold Ctrl/Cmd to toggle multiple groups.</div>
      </div>

      <div class="col-12 d-flex gap-2">
        <button class="btn btn-primary" type="submit">Save changes</button>
        <a class="btn btn-outline-secondary" href="{{ url_for('admin.users_index') }}">Cancel</a>
      </div>
    </div>
  </form>
</div>
{% endblock %}
